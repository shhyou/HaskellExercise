<!DOCTYPE html>
<html class="remark-container"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Interpreters in FLOLAC'14</title>
    <link rel="stylesheet" href="./res/style.css">
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&amp;delayStartupUntil=configured" type="text/javascript"></script>
  </head>
  <body class="remark-container">
    <textarea id="source" style="display: none;">name: inverse
class: inverse, center, middle, front-page
layout: true
---
# Interpreters, FLOLAC'14

.right[unofficial / [suhorng](https://github.com/suhorng/)]

.left[.footnote[This slide: [FT16](https://suhorng.github.io/HaskellExercise/ft16/interp.html)]]
---
layout: false
# FLOLAC'14
http://flolac.iis.sinica.edu.tw/flolac14/doku.php?id=zh-tw:start

- Functional Programming, Dependently Typed Programming

- Logic and Type Theory

- Operational Semantics

- Denotational Semantics

- Lectures on Domain Specific Language
---
# And the derivation trees...
- Typings
\\[
\dfrac
{\dfrac
  {\dfrac{}{- \vdash f : \mathbb{N} \to a} \text{ (var)} \qquad \dfrac{}{- \vdash 3 : \mathbb{N}} \text{ (nat)}}
  {-, f : \mathbb{N} \to a \vdash f\, 3 : a} \text{ (app)}}
{ \vdash \lambda f.\, f\, 3 : (\mathbb{N} \to a) \to a} \text{ (abs)}
\\]

- Operational Semantics
\\[
\dfrac
{\dfrac
  {(\lambda z. z)\, 5 \mapsto z[5 / z]}
  {(\lambda x\, y. x) ((\lambda z. z)\, 5) \mapsto (\lambda x\, y. x)\, 5}}
{(\lambda x\, y. x) ((\lambda z. z)\, 5)\, 3 \mapsto (\lambda x\, y. x)\, 5\, 3}
\\]

- Denotational Semantics

    $[\\![ \mathtt{x} ]\\!] \rho = \rho(\mathtt{x}) $<br/>
    $[\\![ \mathtt{lambda\, x.e} ]\\!] \rho = f$ where $f(x) = [\\![ \mathtt{e} ]\\!] \rho'$ and $\rho' = \rho [\mathtt{x} \mapsto x]$<br/>
    $[\\![ \mathtt{e1\, e2} ]\\!] \rho = ([\\![ \mathtt{e1} ]\\!] \rho)\, ([\\![ \mathtt{e2} ]\\!] \rho)$

---
# $\lambda$ the ultimate
- The syntax
\\[\\begin{aligned}
v \;\; ::&amp;= \;\; \lambda x.\, e \\\\
&amp;| \;\;\;\;\; \mathbb{N}
\\\\
e \;\; ::&amp;= \;\; x, y, z, \dots \\\\
&amp;| \;\;\;\; \lambda x.\, e \\\\
&amp;| \;\;\;\; e\_1\, e_2 \\\\
&amp;| \;\;\;\; e\_1 + e\_2
\\end{aligned}\\]

<br/>
- In Standard ML,

```ocaml
datatype expr = VAR of string
              | LAM of string * expr
              | AP  of expr * expr
              | NUM of int
              | ADD of expr * expr
```
---
name: smallstep
# And the magic computations! .small[[evaluator](#smallstepeval)]
- Recall: value
\\[ \frac{}{(\lambda x.\, M)\, \mathbf{val}} \text{ (fun-v)} \\]
\\[ \frac{n \in \mathbb{N}}{n\, \mathbf{val}} \text{ (nat-v)} \\]

- Call-by-value small-step semantics
\\[ \frac{N\, \mathbf{val}}{(\lambda x.\, M)\,N \mapsto M[N/x]} \text{ (app)} \\]
\\[ \frac{M \mapsto M'}{M\,N \mapsto M'\, N} \text{ (app-l)} \\]
\\[ \frac{N \mapsto N'}{(\lambda x. M)\,N \mapsto (\lambda x. M)\, N'} \text{ (app-r)} \\]
---
# Judgments and Derivations
- A judgment, $J$, could be of form $\text{TERM}\, \mathbf{val}$ or $\Gamma \vdash e : t$. There might also be variables.

- This is an example inference rule
\\[ \dfrac{J_1\; J_2\; \cdots\; J_m}{J} \text{ (rule name)} \\]
where the $J$s are judgments

- Inference rules are combined to get a derivation tree

\\[
\dfrac
{
  \dfrac
  {
    \dfrac
    {5\, \mathbf{val}}
    {(\lambda z. z)\, 5 \mapsto z[5 / z]}
    \text{ (app)}}
  {(\lambda x\, y. x) ((\lambda z. z)\, 5) \mapsto (\lambda x\, y. x)\, 5}
  \text{ (app-r)}}
{(\lambda x\, y. x) ((\lambda z. z)\, 5)\, 3 \mapsto (\lambda x\, y. x)\, 5\, 3}
\text{ (app-l)}
\\]

---
# An evaluator, please!
<br/>
- That's simple, I can make it!

```ocaml
datatype value = FN of (value -> value)
               | N  of int
```

```ocaml
fun eval gamma (VAR x) = Env.lookup x gamma
  | eval gamma (LAM (x, e)) = FN (fn v => eval (Env.extend x v gamma) e)
  | eval gamma (AP (e1, e2)) =
      let val (FN f, v) = (eval gamma e1, eval gamma e2)
      in  f v  end
  | eval gamma (NUM n) = N n
  | eval gamma (ADD (e1, e2)) =
      let val (N n, N m) = (eval gamma e1, eval gamma e2)
      in  N (n+m) end
```
---
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
# .center[The two are quite different, so what?]
---
name: smallstepeval
# A CBV small-step semantics interpreter .small[[sema](#smallstep)]
- They are actually not that unrelated

```ocaml
(* Just a simple substitution, without handling capturing, etc. *)
(* We do not reduce under lambda, so I hopt it's fine... *)
fun subst x M (VAR y) = if x = y then M else (VAR y)
  | subst x M (LAM (y, N)) = LAM (y, if x = y then N else (subst x M N))
  | subst x M (AP (e1, e2)) = AP (subst x M e1, subst x M e2)
  | subst x M (NUM n) = NUM n
  | subst x M (ADD (e1, e2)) = ADD (subst x M e1, subst x M e2)
```

```ocaml
fun reduce (VAR x) = raise (ReduceVar x)
  | reduce (LAM (x,e)) = LAM (x,e)
  | reduce (AP (LAM (x,e), e2)) =
      if isValue e2
      then (subst x e2 e)
      else AP (LAM (x,e), reduce e2)
  | reduce (AP (e1, e2)) = AP (reduce e1, e2)
  | reduce (NUM n) = NUM n
  | reduce (ADD (NUM n, NUM m)) = NUM (n+m)
  | reduce (ADD (NUM n, e2)) = ADD (NUM n, reduce e2)
  | reduce (ADD (e1, e2)) = ADD (reduce e1, e2)
```
---
name: bigstepeval
# And the usual interpreter is... .small[[sema](#bigstep)]
- Oops, not what we have learnt

```ocaml
datatype value = FN of (value -> value)
               | N  of int
```

```ocaml
fun eval gamma (VAR x) = Env.lookup x gamma
  | eval gamma (LAM (x, e)) = FN (fn v => eval (Env.extend x v gamma) e)
  | eval gamma (AP (e1, e2)) =
      let val (FN f, v) = (eval gamma e1, eval gamma e2)
      in  f v  end
  | eval gamma (NUM n) = N n
  | eval gamma (ADD (e1, e2)) =
      let val (N n, N m) = (eval gamma e1, eval gamma e2)
      in  N (n+m) end
```
---
# This is for the common big-step semantics
- Semantics
    * NOT handling divergence

.center[$\dfrac{n\in\mathbb{N}}{n \Downarrow n}$
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$\dfrac{M \Downarrow \lambda x.e \qquad N \Downarrow N' \qquad M'[N' / x] \Downarrow V}{M\, N \Downarrow V}$]
<br/>
.center[$\dfrac{}{\lambda x.e \Downarrow \lambda x.e}$
&nbsp;&nbsp;&nbsp;
$\dfrac{M \Downarrow m \qquad N \Downarrow n}{M+N \Downarrow m+n}$]

- Interpreter

```ocaml
fun step (VAR x) = raise (ReduceVar x)
  | step (LAM (x, e)) = LAM (x, e)
  | step (AP (e1, e2)) = let val LAM (x, e) = step e1
                             val v = step e2
                         in  (step (subst x v e)) end
  | step (NUM n) = NUM n
  | step (ADD (e1, e2)) = let val (NUM n1) = step e1
                              val (NUM n2) = step e2
                          in  (NUM (n1 + n2)) end
```

---
name: bigstep
# A modified big-step semantics .small[[evaluator](#bigstepeval)]
<br/>
<br/>
.center[$\dfrac
{n \in \mathbb{N}}
{\Gamma \vdash n \Downarrow n}$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$\dfrac
{(x,V) \in \Gamma}
{\Gamma \vdash x \Downarrow V}$]
<br/>
<br/>
.center[$\dfrac
{\Gamma \vdash M \Downarrow m
 \qquad
 \Gamma \vdash N \Downarrow n}
 {\Gamma \vdash M+N \Downarrow m+n}$]
<br/>
<br/>
.center[$\dfrac
{\Gamma \vdash M \Downarrow (\lambda x. M')
 \qquad
 \Gamma \vdash N \Downarrow N'
 \qquad
 \Gamma, (x, N') \vdash M' \Downarrow V}
{\Gamma \vdash M\, N \Downarrow V}$]
---
# All are interpreters!
- Type checking also looks like an interpreter
    * And there is a context $\Gamma$

- For dependently typed languages... you realy need to evaluate the terms!

- From these semantics we can get various abstract machines
    </textarea>
    <script src="./res/remark-0.6.0.min.js" type="text/javascript"></script>
    <script src="./res/highlight.pack.js"></script>
    <script type="text/javascript">
      /* override default hljs engine to provide Haskell syntax highlight */
      remark.highlighter.engine = hljs;
      var slideshow = remark.create({
        highlightStyle: 'ir_black'
      });
      MathJax.Hub.Config({
        "HTML-CSS": { scale: 75 },
        tex2jax: {
          skipTags: ['code', 'script', 'noscript', 'style' ,'textarea', 'pre'],
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['\\[', '\\]']]
        }
      });
      MathJax.Hub.Configured();
    </script>
    <div class="remark-notes-area">hello world</div>
</body></html>
